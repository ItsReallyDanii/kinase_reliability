{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://kinase-reliability-pilot.example.com/schemas/sar_schema_v1.json",
  "title": "Structural Audit Report (SAR) Schema v1.0",
  "description": "Schema for Kinase Reliability Pilot SAR outputs with mandatory decision gates",
  "type": "object",
  "required": [
    "pdb_id",
    "sar_version",
    "timestamp",
    "metrics",
    "confidence_assessment",
    "expected_error_range",
    "recommended_action",
    "decision_gate",
    "failure_taxonomy",
    "provenance"
  ],
  "properties": {
    "pdb_id": {
      "type": "string",
      "description": "PDB identifier for the target structure",
      "pattern": "^[0-9][A-Za-z0-9]{3}$"
    },
    "sar_version": {
      "type": "string",
      "description": "SAR schema version",
      "enum": ["1.0"]
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp of SAR generation",
      "format": "date-time"
    },
    "metrics": {
      "type": "object",
      "required": ["rmsd_global", "rmsd_ligand_pocket", "contact_map_overlap", "plddt_mean", "pae_mean"],
      "properties": {
        "rmsd_global": {
          "type": "number",
          "description": "Global RMSD in Angstroms",
          "minimum": 0
        },
        "rmsd_ligand_pocket": {
          "type": ["number", "string"],
          "description": "Ligand pocket RMSD in Angstroms, or 'N/A' if no ligand present"
        },
        "contact_map_overlap": {
          "type": "number",
          "description": "Contact map overlap fraction",
          "minimum": 0,
          "maximum": 1
        },
        "plddt_mean": {
          "type": "number",
          "description": "Mean predicted LDDT score",
          "minimum": 0,
          "maximum": 100
        },
        "pae_mean": {
          "type": "number",
          "description": "Mean predicted aligned error in Angstroms",
          "minimum": 0
        }
      }
    },
    "confidence_assessment": {
      "type": "object",
      "required": ["plddt_bin", "pae_bin", "overall_confidence"],
      "properties": {
        "plddt_bin": {
          "type": "string",
          "enum": ["high", "medium", "low"],
          "description": "pLDDT confidence bin"
        },
        "pae_bin": {
          "type": "string",
          "enum": ["high", "medium", "low"],
          "description": "PAE confidence bin"
        },
        "overall_confidence": {
          "type": "string",
          "enum": ["high", "medium", "low"],
          "description": "Overall confidence assessment"
        }
      }
    },
    "expected_error_range": {
      "type": "object",
      "description": "Expected error range based on confidence assessment (REQUIRED)",
      "required": ["rmsd_min", "rmsd_max", "rationale"],
      "properties": {
        "rmsd_min": {
          "type": "number",
          "description": "Minimum expected RMSD in Angstroms",
          "minimum": 0
        },
        "rmsd_max": {
          "type": "number",
          "description": "Maximum expected RMSD in Angstroms",
          "minimum": 0
        },
        "rationale": {
          "type": "string",
          "description": "Justification for the expected error range"
        }
      }
    },
    "recommended_action": {
      "type": "string",
      "description": "Recommended action based on SAR analysis (REQUIRED)",
      "minLength": 1
    },
    "decision_gate": {
      "type": "string",
      "description": "Mandatory decision gate (REQUIRED)",
      "enum": ["ACCEPT", "REVIEW", "REJECT"]
    },
    "failure_taxonomy": {
      "type": "object",
      "required": ["class", "description"],
      "properties": {
        "class": {
          "type": "string",
          "enum": ["Class A", "Class B", "Class C", "Unknown", "N/A"],
          "description": "Failure class: A=Overconfidence, B=Ligand pose, C=Symmetry/assembly, Unknown=Unmapped, N/A=No failure"
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the failure mode or success"
        }
      }
    },
    "provenance": {
      "type": "object",
      "required": ["model_version", "seed", "recycles"],
      "properties": {
        "model_version": {
          "type": "string",
          "description": "AlphaFold model version used"
        },
        "seed": {
          "type": "integer",
          "description": "Random seed used for inference"
        },
        "recycles": {
          "type": "integer",
          "description": "Number of recycles used",
          "minimum": 0
        },
        "stub_output": {
          "type": "boolean",
          "description": "Flag indicating if this is a deterministic stub output (AF3 unavailable)"
        }
      }
    }
  }
}
